<%- include("partials/header.ejs") %>
    <div class="content mt-5 pt-5 mb-5">
        <a href="/" class="btn btn-light">
            <i class="bi bi-arrow-left"></i>&nbsp;&nbsp;Back to reviews
        </a>

        <div class="card container-md border-light-subtle mt-5 p-3" style="max-width: 1100px;">
            <div class="card-body">
                <h1 class="card-title h2 mb-4">Write new book review</h5>
                    <form action="/editor/<%= locals.post ? post.id : 'submit' %>" method="post"
                        enctype="multipart/form-data" class="row g-4">
                        <div class="col-12">
                            <label for="bookTitle" class="form-label">Book title *</label>
                            <input type="text" class="form-control" name="bookTitle" required
                                placeholder="Enter your book title" value="<%= locals.post ? post.bookTitle : '' %>">
                        </div>
                        <div class="col-md-6">
                            <label for="name" class="form-label">Your name *</label>
                            <input type="text" class="form-control" name="name" required placeholder="Enter your name"
                                value="<%= locals.post ? post.name : '' %>">
                        </div>
                        <div class="col-md-6">
                            <label for="author" class="form-label">Book author *</label>
                            <input type="text" class="form-control" name="author" required
                                placeholder="Enter book author" value="<%= locals.post ? post.author : '' %>">
                        </div>
                        <div class="col-md-6">
                            <label for="genre" class="form-label">Genre *</label>
                            <div class="dropdown">
                                <button class="btn btn-secondary dropdown-toggle w-100" type="button"
                                    data-bs-toggle="dropdown" id="multiSelectDropdown" aria-expanded="false">
                                    Select one or more genres
                                </button>
                                <ul class="dropdown-menu w-100 p-3" aria-labelledby="multiSelectDropdown">
                                    <% genres.forEach(genre=> { %>
                                        <li>
                                            <label class="form-check-label" for="check<%= genre %>">
                                                <input class="form-check-input" type="checkbox" name="genre" value="<%= genre %>"
                                                    id="check<%= genre %>" <%=(locals.post &&
                                                    post.genre.includes(genre)) ? 'checked' : '' %>>
                                                <%= genre %>
                                            </label>
                                        </li>
                                        <% }); %>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="rating" class="form-label">Rating *</label>
                            <select name="rating" required class="form-select form-control" aria-label="rating">
                                <% for (let i=1; i <=5; i++) { %>
                                    <option value="<%= i %>star" <%=(locals.post && post.rating==i + 'star' )
                                        ? 'selected' : '' %>>
                                        <%= 'â˜…' .repeat(i) %>
                                    </option>
                                    <% } %>
                            </select>
                        </div>
                        <div class="col-12">
                            <label for="coverImage" class="form-label">Cover image</label>
                            <% if (locals.post && post.coverImage) { %>
                                <div class="mb-3">
                                    <p class="text-body-secondary">Current image:</p>
                                    <img src="/uploads/<%= post.coverImage.filename %>" alt="Current cover"
                                        style="max-width: 200px; max-height: 300px;">
                                </div>
                                <% } %>
                                    <input type="file" class="form-control" name="coverImage"
                                        placeholder="Upload cover image">
                                    <% if (locals.post && post.coverImage) { %>
                                        <small class="text-body-secondary">Leave empty to keep current image</small>
                                        <% } %>
                        </div>
                        <div class="col-12">
                            <label for="review" class="form-label">Write your review *</label>
                            <textarea class="form-control" name="review" rows="5" required
                                placeholder="Write your complete review. You can write multiple paragraphs."><%= locals.post ? post.review : '' %></textarea>
                        </div>
                        <div class="d-grid gap-3 d-md-flex justify-content-md-end mt-5">
                            <button onclick="history.back()" class="btn btn-outline-secondary">Cancel</button>
                            <button type="submit" class="btn btn-dark">
                                <i class="bi bi-floppy"></i>&nbsp;&nbsp;Publish review
                            </button>
                        </div>
                    </form>
            </div>
        </div>
    </div>
    <%- include("partials/footer.ejs") %>